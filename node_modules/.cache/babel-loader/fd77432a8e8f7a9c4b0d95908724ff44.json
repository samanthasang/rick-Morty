{"ast":null,"code":"import _toConsumableArray from \"@babel/runtime/helpers/esm/toConsumableArray\";\nimport _defineProperty from \"@babel/runtime/helpers/esm/defineProperty\";\nimport _regeneratorRuntime from \"@babel/runtime/helpers/esm/regeneratorRuntime\";\nimport _objectSpread from \"@babel/runtime/helpers/esm/objectSpread2\";\nimport _asyncToGenerator from \"@babel/runtime/helpers/esm/asyncToGenerator\";\nimport RawAsyncValidator from 'async-validator';\nimport * as React from 'react';\nimport warning from \"rc-util/es/warning\";\nimport { defaultValidateMessages } from './messages';\nimport { setValues } from './valueUtil'; // Remove incorrect original ts define\n\nvar AsyncValidator = RawAsyncValidator;\n/**\n * Replace with template.\n *   `I'm ${name}` + { name: 'bamboo' } = I'm bamboo\n */\n\nfunction replaceMessage(template, kv) {\n  return template.replace(/\\$\\{\\w+\\}/g, function (str) {\n    var key = str.slice(2, -1);\n    return kv[key];\n  });\n}\n\nvar CODE_LOGIC_ERROR = 'CODE_LOGIC_ERROR';\n\nfunction validateRule(_x, _x2, _x3, _x4, _x5) {\n  return _validateRule.apply(this, arguments);\n}\n/**\n * We use `async-validator` to validate the value.\n * But only check one value in a time to avoid namePath validate issue.\n */\n\n\nfunction _validateRule() {\n  _validateRule = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee2(name, value, rule, options, messageVariables) {\n    var cloneRule, originValidator, subRuleField, validator, messages, result, subResults, kv, fillVariableResult;\n    return _regeneratorRuntime().wrap(function _callee2$(_context2) {\n      while (1) switch (_context2.prev = _context2.next) {\n        case 0:\n          cloneRule = _objectSpread({}, rule); // Bug of `async-validator`\n          // https://github.com/react-component/field-form/issues/316\n          // https://github.com/react-component/field-form/issues/313\n\n          delete cloneRule.ruleIndex; // https://github.com/ant-design/ant-design/issues/40497#issuecomment-1422282378\n\n          AsyncValidator.warning = function () {\n            return void 0;\n          };\n\n          if (cloneRule.validator) {\n            originValidator = cloneRule.validator;\n\n            cloneRule.validator = function () {\n              try {\n                return originValidator.apply(void 0, arguments);\n              } catch (error) {\n                console.error(error);\n                return Promise.reject(CODE_LOGIC_ERROR);\n              }\n            };\n          } // We should special handle array validate\n\n\n          subRuleField = null;\n\n          if (cloneRule && cloneRule.type === 'array' && cloneRule.defaultField) {\n            subRuleField = cloneRule.defaultField;\n            delete cloneRule.defaultField;\n          }\n\n          validator = new AsyncValidator(_defineProperty({}, name, [cloneRule]));\n          messages = setValues({}, defaultValidateMessages, options.validateMessages);\n          validator.messages(messages);\n          result = [];\n          _context2.prev = 10;\n          _context2.next = 13;\n          return Promise.resolve(validator.validate(_defineProperty({}, name, value), _objectSpread({}, options)));\n\n        case 13:\n          _context2.next = 18;\n          break;\n\n        case 15:\n          _context2.prev = 15;\n          _context2.t0 = _context2[\"catch\"](10);\n\n          if (_context2.t0.errors) {\n            result = _context2.t0.errors.map(function (_ref4, index) {\n              var message = _ref4.message;\n              var mergedMessage = message === CODE_LOGIC_ERROR ? messages.default : message;\n              return /*#__PURE__*/React.isValidElement(mergedMessage) ?\n              /*#__PURE__*/\n              // Wrap ReactNode with `key`\n              React.cloneElement(mergedMessage, {\n                key: \"error_\".concat(index)\n              }) : mergedMessage;\n            });\n          }\n\n        case 18:\n          if (!(!result.length && subRuleField)) {\n            _context2.next = 23;\n            break;\n          }\n\n          _context2.next = 21;\n          return Promise.all(value.map(function (subValue, i) {\n            return validateRule(\"\".concat(name, \".\").concat(i), subValue, subRuleField, options, messageVariables);\n          }));\n\n        case 21:\n          subResults = _context2.sent;\n          return _context2.abrupt(\"return\", subResults.reduce(function (prev, errors) {\n            return [].concat(_toConsumableArray(prev), _toConsumableArray(errors));\n          }, []));\n\n        case 23:\n          // Replace message with variables\n          kv = _objectSpread(_objectSpread({}, rule), {}, {\n            name: name,\n            enum: (rule.enum || []).join(', ')\n          }, messageVariables);\n          fillVariableResult = result.map(function (error) {\n            if (typeof error === 'string') {\n              return replaceMessage(error, kv);\n            }\n\n            return error;\n          });\n          return _context2.abrupt(\"return\", fillVariableResult);\n\n        case 26:\n        case \"end\":\n          return _context2.stop();\n      }\n    }, _callee2, null, [[10, 15]]);\n  }));\n  return _validateRule.apply(this, arguments);\n}\n\nexport function validateRules(namePath, value, rules, options, validateFirst, messageVariables) {\n  var name = namePath.join('.'); // Fill rule with context\n\n  var filledRules = rules.map(function (currentRule, ruleIndex) {\n    var originValidatorFunc = currentRule.validator;\n\n    var cloneRule = _objectSpread(_objectSpread({}, currentRule), {}, {\n      ruleIndex: ruleIndex\n    }); // Replace validator if needed\n\n\n    if (originValidatorFunc) {\n      cloneRule.validator = function (rule, val, callback) {\n        var hasPromise = false; // Wrap callback only accept when promise not provided\n\n        var wrappedCallback = function wrappedCallback() {\n          for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {\n            args[_key] = arguments[_key];\n          } // Wait a tick to make sure return type is a promise\n\n\n          Promise.resolve().then(function () {\n            warning(!hasPromise, 'Your validator function has already return a promise. `callback` will be ignored.');\n\n            if (!hasPromise) {\n              callback.apply(void 0, args);\n            }\n          });\n        }; // Get promise\n\n\n        var promise = originValidatorFunc(rule, val, wrappedCallback);\n        hasPromise = promise && typeof promise.then === 'function' && typeof promise.catch === 'function';\n        /**\n         * 1. Use promise as the first priority.\n         * 2. If promise not exist, use callback with warning instead\n         */\n\n        warning(hasPromise, '`callback` is deprecated. Please return a promise instead.');\n\n        if (hasPromise) {\n          promise.then(function () {\n            callback();\n          }).catch(function (err) {\n            callback(err || ' ');\n          });\n        }\n      };\n    }\n\n    return cloneRule;\n  }).sort(function (_ref, _ref2) {\n    var w1 = _ref.warningOnly,\n        i1 = _ref.ruleIndex;\n    var w2 = _ref2.warningOnly,\n        i2 = _ref2.ruleIndex;\n\n    if (!!w1 === !!w2) {\n      // Let keep origin order\n      return i1 - i2;\n    }\n\n    if (w1) {\n      return 1;\n    }\n\n    return -1;\n  }); // Do validate rules\n\n  var summaryPromise;\n\n  if (validateFirst === true) {\n    // >>>>> Validate by serialization\n    summaryPromise = new Promise( /*#__PURE__*/function () {\n      var _ref3 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee(resolve, reject) {\n        var i, rule, errors;\n        return _regeneratorRuntime().wrap(function _callee$(_context) {\n          while (1) switch (_context.prev = _context.next) {\n            case 0:\n              i = 0;\n\n            case 1:\n              if (!(i < filledRules.length)) {\n                _context.next = 12;\n                break;\n              }\n\n              rule = filledRules[i];\n              _context.next = 5;\n              return validateRule(name, value, rule, options, messageVariables);\n\n            case 5:\n              errors = _context.sent;\n\n              if (!errors.length) {\n                _context.next = 9;\n                break;\n              }\n\n              reject([{\n                errors: errors,\n                rule: rule\n              }]);\n              return _context.abrupt(\"return\");\n\n            case 9:\n              i += 1;\n              _context.next = 1;\n              break;\n\n            case 12:\n              /* eslint-enable */\n              resolve([]);\n\n            case 13:\n            case \"end\":\n              return _context.stop();\n          }\n        }, _callee);\n      }));\n\n      return function (_x6, _x7) {\n        return _ref3.apply(this, arguments);\n      };\n    }());\n  } else {\n    // >>>>> Validate by parallel\n    var rulePromises = filledRules.map(function (rule) {\n      return validateRule(name, value, rule, options, messageVariables).then(function (errors) {\n        return {\n          errors: errors,\n          rule: rule\n        };\n      });\n    });\n    summaryPromise = (validateFirst ? finishOnFirstFailed(rulePromises) : finishOnAllFailed(rulePromises)).then(function (errors) {\n      // Always change to rejection for Field to catch\n      return Promise.reject(errors);\n    });\n  } // Internal catch error to avoid console error log.\n\n\n  summaryPromise.catch(function (e) {\n    return e;\n  });\n  return summaryPromise;\n}\n\nfunction finishOnAllFailed(_x8) {\n  return _finishOnAllFailed.apply(this, arguments);\n}\n\nfunction _finishOnAllFailed() {\n  _finishOnAllFailed = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee3(rulePromises) {\n    return _regeneratorRuntime().wrap(function _callee3$(_context3) {\n      while (1) switch (_context3.prev = _context3.next) {\n        case 0:\n          return _context3.abrupt(\"return\", Promise.all(rulePromises).then(function (errorsList) {\n            var _ref5;\n\n            var errors = (_ref5 = []).concat.apply(_ref5, _toConsumableArray(errorsList));\n\n            return errors;\n          }));\n\n        case 1:\n        case \"end\":\n          return _context3.stop();\n      }\n    }, _callee3);\n  }));\n  return _finishOnAllFailed.apply(this, arguments);\n}\n\nfunction finishOnFirstFailed(_x9) {\n  return _finishOnFirstFailed.apply(this, arguments);\n}\n\nfunction _finishOnFirstFailed() {\n  _finishOnFirstFailed = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee4(rulePromises) {\n    var count;\n    return _regeneratorRuntime().wrap(function _callee4$(_context4) {\n      while (1) switch (_context4.prev = _context4.next) {\n        case 0:\n          count = 0;\n          return _context4.abrupt(\"return\", new Promise(function (resolve) {\n            rulePromises.forEach(function (promise) {\n              promise.then(function (ruleError) {\n                if (ruleError.errors.length) {\n                  resolve([ruleError]);\n                }\n\n                count += 1;\n\n                if (count === rulePromises.length) {\n                  resolve([]);\n                }\n              });\n            });\n          }));\n\n        case 2:\n        case \"end\":\n          return _context4.stop();\n      }\n    }, _callee4);\n  }));\n  return _finishOnFirstFailed.apply(this, arguments);\n}","map":{"version":3,"sources":["/Users/luna/Desktop/Project/Git Project/rick-Morty/node_modules/rc-field-form/es/utils/validateUtil.js"],"names":["_toConsumableArray","_defineProperty","_regeneratorRuntime","_objectSpread","_asyncToGenerator","RawAsyncValidator","React","warning","defaultValidateMessages","setValues","AsyncValidator","replaceMessage","template","kv","replace","str","key","slice","CODE_LOGIC_ERROR","validateRule","_x","_x2","_x3","_x4","_x5","_validateRule","apply","arguments","mark","_callee2","name","value","rule","options","messageVariables","cloneRule","originValidator","subRuleField","validator","messages","result","subResults","fillVariableResult","wrap","_callee2$","_context2","prev","next","ruleIndex","error","console","Promise","reject","type","defaultField","validateMessages","resolve","validate","t0","errors","map","_ref4","index","message","mergedMessage","default","isValidElement","cloneElement","concat","length","all","subValue","i","sent","abrupt","reduce","enum","join","stop","validateRules","namePath","rules","validateFirst","filledRules","currentRule","originValidatorFunc","val","callback","hasPromise","wrappedCallback","_len","args","Array","_key","then","promise","catch","err","sort","_ref","_ref2","w1","warningOnly","i1","w2","i2","summaryPromise","_ref3","_callee","_callee$","_context","_x6","_x7","rulePromises","finishOnFirstFailed","finishOnAllFailed","e","_x8","_finishOnAllFailed","_callee3","_callee3$","_context3","errorsList","_ref5","_x9","_finishOnFirstFailed","_callee4","count","_callee4$","_context4","forEach","ruleError"],"mappings":"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","sourcesContent":["import _toConsumableArray from \"@babel/runtime/helpers/esm/toConsumableArray\";\nimport _defineProperty from \"@babel/runtime/helpers/esm/defineProperty\";\nimport _regeneratorRuntime from \"@babel/runtime/helpers/esm/regeneratorRuntime\";\nimport _objectSpread from \"@babel/runtime/helpers/esm/objectSpread2\";\nimport _asyncToGenerator from \"@babel/runtime/helpers/esm/asyncToGenerator\";\nimport RawAsyncValidator from 'async-validator';\nimport * as React from 'react';\nimport warning from \"rc-util/es/warning\";\nimport { defaultValidateMessages } from './messages';\nimport { setValues } from './valueUtil';\n// Remove incorrect original ts define\nvar AsyncValidator = RawAsyncValidator;\n/**\n * Replace with template.\n *   `I'm ${name}` + { name: 'bamboo' } = I'm bamboo\n */\nfunction replaceMessage(template, kv) {\n  return template.replace(/\\$\\{\\w+\\}/g, function (str) {\n    var key = str.slice(2, -1);\n    return kv[key];\n  });\n}\nvar CODE_LOGIC_ERROR = 'CODE_LOGIC_ERROR';\nfunction validateRule(_x, _x2, _x3, _x4, _x5) {\n  return _validateRule.apply(this, arguments);\n}\n/**\n * We use `async-validator` to validate the value.\n * But only check one value in a time to avoid namePath validate issue.\n */\nfunction _validateRule() {\n  _validateRule = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee2(name, value, rule, options, messageVariables) {\n    var cloneRule, originValidator, subRuleField, validator, messages, result, subResults, kv, fillVariableResult;\n    return _regeneratorRuntime().wrap(function _callee2$(_context2) {\n      while (1) switch (_context2.prev = _context2.next) {\n        case 0:\n          cloneRule = _objectSpread({}, rule); // Bug of `async-validator`\n          // https://github.com/react-component/field-form/issues/316\n          // https://github.com/react-component/field-form/issues/313\n          delete cloneRule.ruleIndex;\n          // https://github.com/ant-design/ant-design/issues/40497#issuecomment-1422282378\n          AsyncValidator.warning = function () {\n            return void 0;\n          };\n          if (cloneRule.validator) {\n            originValidator = cloneRule.validator;\n            cloneRule.validator = function () {\n              try {\n                return originValidator.apply(void 0, arguments);\n              } catch (error) {\n                console.error(error);\n                return Promise.reject(CODE_LOGIC_ERROR);\n              }\n            };\n          }\n          // We should special handle array validate\n          subRuleField = null;\n          if (cloneRule && cloneRule.type === 'array' && cloneRule.defaultField) {\n            subRuleField = cloneRule.defaultField;\n            delete cloneRule.defaultField;\n          }\n          validator = new AsyncValidator(_defineProperty({}, name, [cloneRule]));\n          messages = setValues({}, defaultValidateMessages, options.validateMessages);\n          validator.messages(messages);\n          result = [];\n          _context2.prev = 10;\n          _context2.next = 13;\n          return Promise.resolve(validator.validate(_defineProperty({}, name, value), _objectSpread({}, options)));\n        case 13:\n          _context2.next = 18;\n          break;\n        case 15:\n          _context2.prev = 15;\n          _context2.t0 = _context2[\"catch\"](10);\n          if (_context2.t0.errors) {\n            result = _context2.t0.errors.map(function (_ref4, index) {\n              var message = _ref4.message;\n              var mergedMessage = message === CODE_LOGIC_ERROR ? messages.default : message;\n              return /*#__PURE__*/React.isValidElement(mergedMessage) ?\n              /*#__PURE__*/\n              // Wrap ReactNode with `key`\n              React.cloneElement(mergedMessage, {\n                key: \"error_\".concat(index)\n              }) : mergedMessage;\n            });\n          }\n        case 18:\n          if (!(!result.length && subRuleField)) {\n            _context2.next = 23;\n            break;\n          }\n          _context2.next = 21;\n          return Promise.all(value.map(function (subValue, i) {\n            return validateRule(\"\".concat(name, \".\").concat(i), subValue, subRuleField, options, messageVariables);\n          }));\n        case 21:\n          subResults = _context2.sent;\n          return _context2.abrupt(\"return\", subResults.reduce(function (prev, errors) {\n            return [].concat(_toConsumableArray(prev), _toConsumableArray(errors));\n          }, []));\n        case 23:\n          // Replace message with variables\n          kv = _objectSpread(_objectSpread({}, rule), {}, {\n            name: name,\n            enum: (rule.enum || []).join(', ')\n          }, messageVariables);\n          fillVariableResult = result.map(function (error) {\n            if (typeof error === 'string') {\n              return replaceMessage(error, kv);\n            }\n            return error;\n          });\n          return _context2.abrupt(\"return\", fillVariableResult);\n        case 26:\n        case \"end\":\n          return _context2.stop();\n      }\n    }, _callee2, null, [[10, 15]]);\n  }));\n  return _validateRule.apply(this, arguments);\n}\nexport function validateRules(namePath, value, rules, options, validateFirst, messageVariables) {\n  var name = namePath.join('.');\n  // Fill rule with context\n  var filledRules = rules.map(function (currentRule, ruleIndex) {\n    var originValidatorFunc = currentRule.validator;\n    var cloneRule = _objectSpread(_objectSpread({}, currentRule), {}, {\n      ruleIndex: ruleIndex\n    });\n    // Replace validator if needed\n    if (originValidatorFunc) {\n      cloneRule.validator = function (rule, val, callback) {\n        var hasPromise = false;\n        // Wrap callback only accept when promise not provided\n        var wrappedCallback = function wrappedCallback() {\n          for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {\n            args[_key] = arguments[_key];\n          }\n          // Wait a tick to make sure return type is a promise\n          Promise.resolve().then(function () {\n            warning(!hasPromise, 'Your validator function has already return a promise. `callback` will be ignored.');\n            if (!hasPromise) {\n              callback.apply(void 0, args);\n            }\n          });\n        };\n        // Get promise\n        var promise = originValidatorFunc(rule, val, wrappedCallback);\n        hasPromise = promise && typeof promise.then === 'function' && typeof promise.catch === 'function';\n        /**\n         * 1. Use promise as the first priority.\n         * 2. If promise not exist, use callback with warning instead\n         */\n        warning(hasPromise, '`callback` is deprecated. Please return a promise instead.');\n        if (hasPromise) {\n          promise.then(function () {\n            callback();\n          }).catch(function (err) {\n            callback(err || ' ');\n          });\n        }\n      };\n    }\n    return cloneRule;\n  }).sort(function (_ref, _ref2) {\n    var w1 = _ref.warningOnly,\n      i1 = _ref.ruleIndex;\n    var w2 = _ref2.warningOnly,\n      i2 = _ref2.ruleIndex;\n    if (!!w1 === !!w2) {\n      // Let keep origin order\n      return i1 - i2;\n    }\n    if (w1) {\n      return 1;\n    }\n    return -1;\n  });\n  // Do validate rules\n  var summaryPromise;\n  if (validateFirst === true) {\n    // >>>>> Validate by serialization\n    summaryPromise = new Promise( /*#__PURE__*/function () {\n      var _ref3 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee(resolve, reject) {\n        var i, rule, errors;\n        return _regeneratorRuntime().wrap(function _callee$(_context) {\n          while (1) switch (_context.prev = _context.next) {\n            case 0:\n              i = 0;\n            case 1:\n              if (!(i < filledRules.length)) {\n                _context.next = 12;\n                break;\n              }\n              rule = filledRules[i];\n              _context.next = 5;\n              return validateRule(name, value, rule, options, messageVariables);\n            case 5:\n              errors = _context.sent;\n              if (!errors.length) {\n                _context.next = 9;\n                break;\n              }\n              reject([{\n                errors: errors,\n                rule: rule\n              }]);\n              return _context.abrupt(\"return\");\n            case 9:\n              i += 1;\n              _context.next = 1;\n              break;\n            case 12:\n              /* eslint-enable */\n              resolve([]);\n            case 13:\n            case \"end\":\n              return _context.stop();\n          }\n        }, _callee);\n      }));\n      return function (_x6, _x7) {\n        return _ref3.apply(this, arguments);\n      };\n    }());\n  } else {\n    // >>>>> Validate by parallel\n    var rulePromises = filledRules.map(function (rule) {\n      return validateRule(name, value, rule, options, messageVariables).then(function (errors) {\n        return {\n          errors: errors,\n          rule: rule\n        };\n      });\n    });\n    summaryPromise = (validateFirst ? finishOnFirstFailed(rulePromises) : finishOnAllFailed(rulePromises)).then(function (errors) {\n      // Always change to rejection for Field to catch\n      return Promise.reject(errors);\n    });\n  }\n  // Internal catch error to avoid console error log.\n  summaryPromise.catch(function (e) {\n    return e;\n  });\n  return summaryPromise;\n}\nfunction finishOnAllFailed(_x8) {\n  return _finishOnAllFailed.apply(this, arguments);\n}\nfunction _finishOnAllFailed() {\n  _finishOnAllFailed = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee3(rulePromises) {\n    return _regeneratorRuntime().wrap(function _callee3$(_context3) {\n      while (1) switch (_context3.prev = _context3.next) {\n        case 0:\n          return _context3.abrupt(\"return\", Promise.all(rulePromises).then(function (errorsList) {\n            var _ref5;\n            var errors = (_ref5 = []).concat.apply(_ref5, _toConsumableArray(errorsList));\n            return errors;\n          }));\n        case 1:\n        case \"end\":\n          return _context3.stop();\n      }\n    }, _callee3);\n  }));\n  return _finishOnAllFailed.apply(this, arguments);\n}\nfunction finishOnFirstFailed(_x9) {\n  return _finishOnFirstFailed.apply(this, arguments);\n}\nfunction _finishOnFirstFailed() {\n  _finishOnFirstFailed = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee4(rulePromises) {\n    var count;\n    return _regeneratorRuntime().wrap(function _callee4$(_context4) {\n      while (1) switch (_context4.prev = _context4.next) {\n        case 0:\n          count = 0;\n          return _context4.abrupt(\"return\", new Promise(function (resolve) {\n            rulePromises.forEach(function (promise) {\n              promise.then(function (ruleError) {\n                if (ruleError.errors.length) {\n                  resolve([ruleError]);\n                }\n                count += 1;\n                if (count === rulePromises.length) {\n                  resolve([]);\n                }\n              });\n            });\n          }));\n        case 2:\n        case \"end\":\n          return _context4.stop();\n      }\n    }, _callee4);\n  }));\n  return _finishOnFirstFailed.apply(this, arguments);\n}"]},"metadata":{},"sourceType":"module"}